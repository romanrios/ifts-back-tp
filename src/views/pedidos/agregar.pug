extends ../layout

block content
  h2.mb-3 Agregar Nuevo Pedido

  form(action="/pedidos/agregar" method="POST")
    .mb-3
      label.form-label(for="cliente") Cliente
      select.form-select(name="cliente" id="cliente" required)
        option(value="" disabled selected) Selecciona un cliente
        each c in clientes
          option(value=c._id)= `${c.nombre} (${c.telefono})`

    .mb-3
      label.form-label(for="producto") Producto
      select.form-select(name="producto" id="producto" required onchange="actualizarPrecio()")
        option(value="" disabled selected) Selecciona un producto
        each p in productos
          //- Guardamos el precio en un atributo data-precio
          option(value=p._id data-precio=p.precio)= `${p.nombre} - $${p.precio}`

    .mb-3
      label.form-label(for="precio") Precio
      input.form-control(type="number" step="0.01" name="precio" id="precio" placeholder="Se completará automáticamente" required readonly)

    .mb-3
      label.form-label(for="plataforma") Plataforma
      select.form-select(name="plataforma" id="plataforma" required)
        option(value="" disabled selected) Selecciona una plataforma
        each plataforma in plataformas
          option(value=plataforma._id)= `${plataforma.nombre} (${plataforma.tipo})`

    .mb-3
      label.form-label(for="idEmpleado") Empleado asignado
      select.form-select(name="idEmpleado" id="idEmpleado" required)
        option(value="" disabled selected) Selecciona un empleado
        each empleado in empleados
          option(value=empleado._id)= `${empleado.rol} (${empleado.area})`

    .d-flex.gap-2
      button.btn.btn-primary(type="submit") Agregar Pedido
      a.btn.btn-secondary(href="/") Cancelar

  //- Script para actualizar el precio automáticamente
  script.
    function actualizarPrecio() {
      const select = document.getElementById('producto');
      const precioInput = document.getElementById('precio');
      const selectedOption = select.options[select.selectedIndex];
      const precio = selectedOption.getAttribute('data-precio');
      precioInput.value = precio || '';
    }
